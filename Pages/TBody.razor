<tbody>
    <tr class="@Body.Hidden[1] btn-primary active" style="font-weight: bold">
        <td class="text-left">Total</td>
        <td>@(Body.Transactions.Where(t => t.IsIncome).Sum(t => t.LastMonth) - Body.Transactions.Where(t => t.IsIncome == false).Sum(t => t.LastMonth) + " €")</td>
        <td>@(Body.Transactions.Where(t => t.IsIncome).Sum(t => t.ThisMonth) - Body.Transactions.Where(t => t.IsIncome == false).Sum(t => t.ThisMonth) + " €")</td>
        <td></td>
    </tr>
    <tr class="@Body.Hidden[1] btn-success active" style="font-weight: bold">
        <td class="text-left">Income</td>
        <td>@(Body.Transactions.Where(t => t.IsIncome).Sum(e => e.LastMonth) + " €")</td>
        <td>@(Body.Transactions.Where(t => t.IsIncome).Sum(e => e.ThisMonth) + " €")</td>
        <td></td>
    </tr>
    @foreach (var category in Income)
    {
        <tr class="@Body.Hidden[1] btn-success " style="font-weight: bold">
            <td class="text-left">@category.Key</td>
            <td>@(category.Sum(e => e.LastMonth) + " €")</td>
            <td>@(category.Sum(e => e.ThisMonth) + " €")</td>
            <td></td>
        </tr>
        @foreach (var transaction in category)
        {
            <CascadingValue Value="this"><TR Transaction="transaction" /></CascadingValue>
        }
    }
    <tr class="@Body.Hidden[1] btn-danger active" style="font-weight: bold">
        <td class="text-left">Expenses</td>
        <td>@(Body.Transactions.Where(t => t.IsIncome == false).Sum(e => e.LastMonth) + " €")</td>
        <td>@(Body.Transactions.Where(t => t.IsIncome == false).Sum(e => e.ThisMonth) + " €")</td>
        <td></td>
    </tr>
    @foreach (var category in Expense)
    {
        <tr class="@Body.Hidden[1] btn-danger" style="font-weight: bold">
            <td class="text-left">@category.Key</td>
            <td>@(category.Sum(e => e.LastMonth) + " €")</td>
            <td >@(category.Sum(e => e.ThisMonth) + " €")</td>
            <td></td>
        </tr>
        @foreach (var transaction in category)
        {
            <CascadingValue Value="this"><TR Transaction="transaction" /></CascadingValue>
        }
    }
</tbody>

@code {
    [CascadingParameter] Body Body { get; set; }

    public IEnumerable<IGrouping<string, Transaction>> Income { get; set; }
    public IEnumerable<IGrouping<string, Transaction>> Expense { get; set; }
    
    protected override void OnParametersSet()
    {
        Income = Body.Transactions.Where(t => t.IsIncome).OrderBy(t => t.Category).ThenBy(t => t.Title).GroupBy(t => t.Category);
        Expense = Body.Transactions.Where(t => t.IsIncome == false).OrderBy(t => t.Category).ThenBy(t => t.Title).GroupBy(t => t.Category);
    }
}